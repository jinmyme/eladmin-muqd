(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-ba76","chunk-ca0f","chunk-eb67"],{"99or":function(t,e,s){"use strict";s.r(e);var a=s("QbLZ"),i=s.n(a),r=s("L2JU"),o=s("7Qib"),n=s("dUbn"),l=s("q4Ke"),c=s("F3lR"),u=s("X4fA"),d=s("Q2AE"),f={name:"Center",components:{updatePass:n.default,updateEmail:l.default,log:c.default},data:function(){return{ico:"el-icon-refresh",headers:{Authorization:"Bearer "+Object(u.a)()}}},computed:i()({},Object(r.b)(["user","updateAvatarApi"])),created:function(){d.a.dispatch("GetInfo").then(function(){})},methods:{parseTime:o.c,formatEmail:function(t){return Object(o.d)(t)},handleSuccess:function(t,e,s){this.$notify({title:"头像修改成功",type:"success",duration:2500}),d.a.dispatch("GetInfo").then(function(){})},handleError:function(t,e,s){var a=JSON.parse(t.message);this.$notify({title:a.message,type:"error",duration:2500})},refresh:function(){var t=this;this.ico="el-icon-loading",this.$refs.log.init(),setTimeout(function(){t.ico="el-icon-refresh"},300)}}},m=(s("fnfW"),s("KHd+")),p=Object(m.a)(f,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"app-container"},[s("el-row",{attrs:{gutter:20}},[s("el-col",{attrs:{xs:24,sm:24,md:8,lg:6,xl:5}},[s("el-card",{staticClass:"box-card"},[s("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[s("span",[t._v("个人信息")])]),t._v(" "),s("div",[s("div",{staticStyle:{"text-align":"center"}},[s("el-upload",{staticClass:"avatar-uploader",attrs:{"show-file-list":!1,"on-success":t.handleSuccess,"on-error":t.handleError,headers:t.headers,action:t.updateAvatarApi}},[t.user.avatar?s("img",{staticClass:"avatar",attrs:{src:t.user.avatar,title:"点击上传头像"}}):s("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),t._v(" "),s("ul",{staticClass:"user-info"},[s("li",[s("svg-icon",{attrs:{"icon-class":"user1"}}),t._v(" 用户名称 "),s("div",{staticClass:"user-right"},[t._v(t._s(t.user.username))])],1),t._v(" "),s("li",[s("svg-icon",{attrs:{"icon-class":"phone"}}),t._v(" 手机号码 "),s("div",{staticClass:"user-right"},[t._v(t._s(t.user.phone))])],1),t._v(" "),s("li",[s("svg-icon",{attrs:{"icon-class":"email"}}),t._v(" 用户邮箱 "),s("div",{staticClass:"user-right"},[t._v(t._s(t.user.email))])],1),t._v(" "),s("li",[s("svg-icon",{attrs:{"icon-class":"dept"}}),t._v(" 所属部门 "),s("div",{staticClass:"user-right"},[t._v(" "+t._s(t.user.dept)+" / "+t._s(t.user.job))])],1),t._v(" "),s("li",[s("svg-icon",{attrs:{"icon-class":"date"}}),t._v(" 创建日期 "),s("div",{staticClass:"user-right"},[t._v(t._s(t.parseTime(t.user.createTime)))])],1),t._v(" "),s("li",[s("svg-icon",{attrs:{"icon-class":"anq"}}),t._v(" 安全设置\n              "),s("div",{staticClass:"user-right"},[s("a",{on:{click:function(e){t.$refs.pass.dialog=!0}}},[t._v("修改密码")]),t._v(" "),s("a",{on:{click:function(e){t.$refs.email.dialog=!0}}},[t._v("修改邮箱")])])],1)])])])],1),t._v(" "),s("el-col",{attrs:{xs:24,sm:24,md:16,lg:18,xl:19}},[s("el-card",{staticClass:"box-card"},[s("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[s("span",[t._v("操作日志")]),t._v(" "),s("div",{staticStyle:{display:"inline-block",float:"right",cursor:"pointer"},on:{click:t.refresh}},[s("i",{class:t.ico})])]),t._v(" "),s("log",{ref:"log"})],1)],1)],1),t._v(" "),s("updateEmail",{ref:"email",attrs:{email:t.user.email}}),t._v(" "),s("updatePass",{ref:"pass"})],1)},[],!1,null,null,null);p.options.__file="center.vue";e.default=p.exports},Fb8z:function(t,e,s){"use strict";var a=s("rS5I");s.n(a).a},HZIk:function(t,e,s){},Yfch:function(t,e,s){"use strict";function a(t){return/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/.test(t)}s.d(e,"a",function(){return a})},dUbn:function(t,e,s){"use strict";s.r(e);var a=s("Q2AE"),i=s("wk8/"),r={data:function(){var t=this;return{loading:!1,dialog:!1,title:"修改密码",form:{oldPass:"",newPass:"",confirmPass:""},rules:{oldPass:[{required:!0,validator:function(t,e,s){e?Object(i.h)(e).then(function(t){200===t.status?s():s(new Error("旧密码错误，请检查"))}):s(new Error("请输入旧密码"))},trigger:"blur"}],newPass:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"}],confirmPass:[{required:!0,validator:function(e,s,a){t.form.newPass!==s?a(new Error("两次输入的密码不一致")):a()},trigger:"blur"}]}}},methods:{cancel:function(){this.resetForm()},doSubmit:function(){var t=this;this.$refs.form.validate(function(e){if(!e)return!1;t.loading=!0,Object(i.f)(t.form.confirmPass).then(function(e){t.resetForm(),t.$notify({title:"密码修改成功，请重新登录",type:"success",duration:1500}),setTimeout(function(){a.a.dispatch("LogOut").then(function(){location.reload()})},1500)}).catch(function(e){t.loading=!1,console.log(e.response.data.message)})})},resetForm:function(){this.dialog=!1,this.$refs.form.resetFields(),this.form={oldPass:"",newPass:"",confirmPass:""}}}},o=(s("o2Go"),s("KHd+")),n=Object(o.a)(r,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticStyle:{display:"inline-block"}},[s("el-dialog",{attrs:{visible:t.dialog,title:t.title,"append-to-body":"",width:"500px"},on:{"update:visible":function(e){t.dialog=e},close:t.cancel}},[s("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,size:"small","label-width":"88px"}},[s("el-form-item",{attrs:{label:"旧密码",prop:"oldPass"}},[s("el-input",{staticStyle:{width:"370px"},attrs:{type:"password","auto-complete":"on"},model:{value:t.form.oldPass,callback:function(e){t.$set(t.form,"oldPass",e)},expression:"form.oldPass"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"新密码",prop:"newPass"}},[s("el-input",{staticStyle:{width:"370px"},attrs:{type:"password","auto-complete":"on"},model:{value:t.form.newPass,callback:function(e){t.$set(t.form,"newPass",e)},expression:"form.newPass"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"确认密码",prop:"confirmPass"}},[s("el-input",{staticStyle:{width:"370px"},attrs:{type:"password","auto-complete":"on"},model:{value:t.form.confirmPass,callback:function(e){t.$set(t.form,"confirmPass",e)},expression:"form.confirmPass"}})],1)],1),t._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{type:"text"},on:{click:t.cancel}},[t._v("取消")]),t._v(" "),s("el-button",{attrs:{loading:t.loading,type:"primary"},on:{click:t.doSubmit}},[t._v("确认")])],1)],1)],1)},[],!1,null,"65fca9ba",null);n.options.__file="updatePass.vue";e.default=n.exports},fnfW:function(t,e,s){"use strict";var a=s("HZIk");s.n(a).a},o2Go:function(t,e,s){"use strict";var a=s("yAUg");s.n(a).a},q4Ke:function(t,e,s){"use strict";s.r(e);var a=s("Q2AE"),i=s("Yfch"),r=s("wk8/"),o=s("t3Un");var n={props:{email:{type:String,required:!0}},data:function(){var t=this;return{loading:!1,dialog:!1,title:"修改邮箱",form:{pass:"",email:"",code:""},user:{email:"",password:""},codeLoading:!1,codeData:{type:"email",value:""},buttonName:"获取验证码",isDisabled:!1,time:60,rules:{pass:[{required:!0,validator:function(t,e,s){Object(r.h)(e).then(function(t){200===t.status?s():s(new Error("密码错误，请重新输入"))})},trigger:"blur"}],email:[{required:!0,validator:function(e,s,a){""===s?a(new Error("新邮箱不能为空")):s===t.email?a(new Error("新邮箱不能与旧邮箱相同")):Object(i.a)(s)?a():a(new Error("邮箱格式错误"))},trigger:"blur"}],code:[{required:!0,message:"验证码不能为空",trigger:"blur"}]}}},methods:{cancel:function(){this.resetForm()},sendCode:function(){var t=this;if(this.form.email&&this.form.email!==this.email){this.codeLoading=!0,this.buttonName="验证码发送中",this.codeData.value=this.form.email;var e=this;(function(t){return Object(o.a)({url:"api/code/resetEmail",method:"post",data:t})})(this.codeData).then(function(s){t.$message({showClose:!0,message:"发送成功，验证码有效期5分钟",type:"success"}),t.codeLoading=!1,t.isDisabled=!0,t.buttonName=t.time--+"秒后重新发送",t.timer=window.setInterval(function(){e.buttonName=e.time+"秒后重新发送",--e.time,e.time<0&&(e.buttonName="重新发送",e.time=60,e.isDisabled=!1,window.clearInterval(e.timer))},1e3)}).catch(function(e){t.resetForm(),t.codeLoading=!1,console.log(e.response.data.message)})}},doSubmit:function(){var t=this;this.$refs.form.validate(function(e){if(!e)return!1;t.loading=!0,t.user={email:t.form.email,password:t.form.pass},Object(r.e)(t.form.code,t.user).then(function(e){t.loading=!1,t.resetForm(),t.$notify({title:"邮箱修改成功",type:"success",duration:1500}),a.a.dispatch("GetInfo").then(function(){})}).catch(function(e){t.loading=!1,console.log(e.response.data.message)})})},resetForm:function(){this.dialog=!1,this.$refs.form.resetFields(),window.clearInterval(this.timer),this.time=60,this.buttonName="获取验证码",this.isDisabled=!1,this.form={pass:"",email:"",code:""}}}},l=(s("Fb8z"),s("KHd+")),c=Object(l.a)(n,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticStyle:{display:"inline-block"}},[s("el-dialog",{attrs:{visible:t.dialog,title:t.title,"append-to-body":"",width:"475px"},on:{"update:visible":function(e){t.dialog=e},close:t.cancel}},[s("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,size:"small","label-width":"88px"}},[s("el-form-item",{attrs:{label:"新邮箱",prop:"email"}},[s("el-input",{staticStyle:{width:"200px"},attrs:{"auto-complete":"on"},model:{value:t.form.email,callback:function(e){t.$set(t.form,"email",e)},expression:"form.email"}}),t._v(" "),s("el-button",{attrs:{loading:t.codeLoading,disabled:t.isDisabled,size:"small"},on:{click:t.sendCode}},[t._v(t._s(t.buttonName))])],1),t._v(" "),s("el-form-item",{attrs:{label:"验证码",prop:"code"}},[s("el-input",{staticStyle:{width:"320px"},model:{value:t.form.code,callback:function(e){t.$set(t.form,"code",e)},expression:"form.code"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"当前密码",prop:"pass"}},[s("el-input",{staticStyle:{width:"320px"},attrs:{type:"password"},model:{value:t.form.pass,callback:function(e){t.$set(t.form,"pass",e)},expression:"form.pass"}})],1)],1),t._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{type:"text"},on:{click:t.cancel}},[t._v("取消")]),t._v(" "),s("el-button",{attrs:{loading:t.loading,type:"primary"},on:{click:t.doSubmit}},[t._v("确认")])],1)],1)],1)},[],!1,null,"72e507c3",null);c.options.__file="updateEmail.vue";e.default=c.exports},rS5I:function(t,e,s){},"wk8/":function(t,e,s){"use strict";s.d(e,"g",function(){return i}),s.d(e,"a",function(){return r}),s.d(e,"b",function(){return o}),s.d(e,"c",function(){return n}),s.d(e,"d",function(){return l}),s.d(e,"h",function(){return c}),s.d(e,"f",function(){return u}),s.d(e,"e",function(){return d});var a=s("t3Un");function i(t){return Object(a.a)({url:"/index.php/manage/User/user_list",method:"post",data:t})}function r(t){return Object(a.a)({url:"/index.php/manage/User/user_add",method:"post",data:t})}function o(t){return Object(a.a)({url:"index.php/manage/user/user_del",method:"post",data:t})}function n(t){return Object(a.a)({url:"/index.php/manage/User/user_edit",method:"post",data:t})}function l(t){return Object(a.a)({url:"/index.php/manage/user/role_list",method:"post",data:t})}function c(t){return Object(a.a)({url:"api/users/validPass/"+t,method:"get"})}function u(t){return Object(a.a)({url:"api/users/updatePass/"+t,method:"get"})}function d(t,e){return Object(a.a)({url:"api/users/updateEmail/"+t,method:"post",data:e})}},yAUg:function(t,e,s){}}]);